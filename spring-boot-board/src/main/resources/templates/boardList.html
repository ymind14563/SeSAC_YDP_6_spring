<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Post List</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="/board.css">
</head>
<body>
<h1>Post List</h1>

<!-- 작성자 검색 인풋-->
<div style="margin-bottom: 20px;">
    <label for="searchWriter">Search by writer:</label>
    <input type="text" id="searchWriter" placeholder="유저명을 검색해보세요 (정확한 작성자명)">
    <button type="button" id="searchButton" class="btn">검색</button>
</div>

<a href="/posts/new" class="btn">게시글 등록</a>
<table id="postTable">
    <thead>
    <tr>
        <th>No</th>
        <th>writer</th>
        <th>title</th>
        <th>content</th>
        <th>registered</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetchPosts();  // 초기 로딩 시 모든 게시글 불러오기

        // 검색 버튼 클릭 시 검색 함수 호출
        document.getElementById('searchButton').addEventListener('click', function() {
            const writer = document.getElementById('searchWriter').value;
            searchPostsByWriter(writer);
        });
    });

    function fetchPosts() {
        axios.get('/api/posts')
            .then(function (response) {
                renderPosts(response.data);
            })
            .catch(function (error) {
                console.error('Error:', error);
            });
    }

    // 작성자 검색 결과
    function searchPostsByWriter(writer) {
        axios.get(`/api/posts/search?writer=${writer}`)
            .then(function(response) {
                renderPosts(response.data);
            })
            .catch(function(error) {
                console.error('Error:', error);
            });
    }

    function renderPosts(posts) {
        const tbody = document.querySelector('#postTable tbody');
        tbody.innerHTML = '';
        posts.forEach(function(post) {
            const registeredDate = post.registered ? new Date(post.registered).toLocaleDateString() : 'No Date';
            const row = `
                <tr>
                    <td>${post.no}</td>
                    <td>${post.writer}</td>
                    <td>${post.title}</td>
                    <td>${post.content}</td>
                    <td>${registeredDate}</td>
                    <td class="action-buttons">
                        <a href="/posts/${post.id}/edit" class="btn">수정</a>
                        <button onclick="deletePost(${post.id})" class="btn btn-danger">삭제</button>
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    function deletePost(id) {
        if (confirm('정말로 삭제하시겠습니까?')) {
            axios.delete('/api/posts/' + id)
                .then(function (response) {
                    fetchPosts();  // 삭제 후 목록 갱신
                })
                .catch(function (error) {
                    console.error('Error:', error);
                });
        }
    }
</script>
</body>
</html>
